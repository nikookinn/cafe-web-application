<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/menu-detail-style.css}" rel="stylesheet">
</head>
<body class="bg-gray-50">
<div th:replace="~{main/main-navbar :: main-navbar}"></div>
<!-- Header Image with Title -->
<div class="relative h-40 md:h-96 w-full menu-image-container">
    <img th:src="${menuDto.existingImageUrl != null ? menuDto.existingImageUrl : null}" alt="Menu Header" class="w-full h-full object-cover">
    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center flex-col">
        <h1 class="menu-title text-white text-4xl md:text-6xl" th:text="${menuDto.name}">Menu Name</h1>
        <!-- Back to homepage link with Thymeleaf -->
        <a th:href="@{/}" class="menu-title text-white mf-size hover:underline">
            Əsas Səhifə
        </a>
    </div>
</div>


<!-- Category Buttons -->
<div class="py-6 px-4 bg-white shadow-sm">
    <div class="flex flex-wrap gap-2" id="categoryContainer">
        <th:block th:each="category, iterStat : ${categories}">
            <button th:text="${category.name}"
                    th:data-category-id="${category.categoryId}"
                    th:data-category="${category.name}"
                    class="category-btn text-sm font-medium transition-all"
                    th:classappend="${iterStat.first} ? 'active' : 'text-gray-600 hover:bg-gray-100'"
                    onclick="handleCategoryClick(event)">
                <span>Category</span>
            </button>
        </th:block>
    </div>
</div>


<!-- Menu Items Grid -->
<div class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-2 gap-2 -m-3" id="menuItems">
        <div id="menuItemsContainer"></div>
    </div>
</div>

<div th:replace="~{main/main-footer :: main-footer}"></div>
<script>
    function toggleDescription(element) {
        const description = element.querySelector('p');

        if (description.textContent.length < 100) {
            return;
        }
        element.classList.toggle('expanded');
        description.classList.toggle('line-clamp');

        document.addEventListener("DOMContentLoaded", function() {
            const firstCategoryButton = document.querySelector('.category-btn.active');
            if (firstCategoryButton) {
                const categoryId = firstCategoryButton.getAttribute('data-category-id');
                fetchItemsByCategory(categoryId);
            }
        });
    }
    document.addEventListener('DOMContentLoaded', function () {
        const firstButton = document.querySelector('#categoryContainer button');

        // Eğer bir buton varsa, data-category-id değerini alıyoruz
        if (firstButton) {
            const categoryId = firstButton.getAttribute('data-category-id');

            // Burada, categoryId ile sorgu yapabilirsiniz (örneğin API'ye istek gönderebilirsiniz)
            fetchItemsByCategory(categoryId);
        }
    });
    function fetchItemsByCategory(categoryId) {
        // Making the API request with the categoryId
        fetch("/menu/api/items?id=" + categoryId)
            .then(response => response.json()) // Parse the JSON response
            .then(data => {
                // Get the menuItems container element
                const menuItemsContainer = document.getElementById('menuItems');

                // Clear any previous content in the container
                menuItemsContainer.innerHTML = '';

                // Loop through each item and create HTML for each
                data.forEach(item => {
                    const menuCard = document.createElement('div');
                    menuCard.classList.add('menu-card', 'bg-gray-900', 'text-white', 'rounded-lg', 'shadow-lg', 'relative', 'overflow-hidden');
                    menuCard.style.minHeight = '265px'; // Apply inline style for min-height

                    // Create description container
                    const descriptionContainer = document.createElement('div');
                    descriptionContainer.classList.add('description-container');
                    descriptionContainer.setAttribute('onclick', 'toggleDescription(this)');

                    // Add item name
                    const itemName = document.createElement('h4');
                    itemName.classList.add('menu-item-name', 'text-1xl', 'font-bold', 'text-left', 'text-white', '-mt-3');
                    itemName.textContent = item.name;

                    // Add item description
                    const description = document.createElement('p');
                    description.classList.add('text-sm', 'text-gray-300', 'line-clamp');
                    description.textContent = item.description;

                    // Check if the description length exceeds 100 characters
                    if (item.description.length >= 100) {
                        descriptionContainer.classList.add('has-more');
                    }

                    // Append both item name and description to the descriptionContainer
                    descriptionContainer.appendChild(itemName);
                    descriptionContainer.appendChild(description);

                    // Add other content to the menu card
                    menuCard.innerHTML = `
                    <div class="relative">
                        <img src="${item.imageUrl}" alt="Menu Item" class="w-full h-40 sm:h-64 object-cover rounded-t-lg">
                        <span class="absolute top-2 right-2 text-xl font-bold bg-blue-900 bg-opacity-80 text-white px-2 py-1 rounded-lg shadow-lg transform -translate-y-1/5 backdrop-blur-lg">
                            ${item.price} ₼
                        </span>
                    </div>
                    <div class="p-3 sm:p-4 -m-3">
                        <!-- Description container with name and description will be appended here -->
                    </div>
                `;

                    // Append descriptionContainer to menuCard
                    menuCard.querySelector('.p-3').appendChild(descriptionContainer);

                    // Append the created menuCard to the menuItems container
                    menuItemsContainer.appendChild(menuCard);
                });
            })
            .catch(error => {
                console.error('Error fetching items:', error);
            });
    }


    function handleCategoryClick(event) {
        const categoryId = event.target.getAttribute('data-category-id');

        // Remove 'active' class from all buttons
        const buttons = document.querySelectorAll('.category-btn');
        buttons.forEach(button => button.classList.remove('active'));

        // Add 'active' class to the clicked button
        event.target.classList.add('active');

        // Fetch and display items for the selected category
        fetchItemsByCategory(categoryId);
    }
    document.addEventListener('DOMContentLoaded', function () {
        const descriptionContainers = document.querySelectorAll('.description-container');

        descriptionContainers.forEach(container => {
            const description = container.querySelector('p');
            const readMoreText = container.querySelector('::after');

            // If the description is too short, hide "Read more" text
            if (description && description.textContent.length < 100) {
                container.classList.remove('has-more');
            } else {
                container.classList.add('has-more');
            }
        });
    });



</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>
</html>
